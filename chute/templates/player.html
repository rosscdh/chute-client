<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>&nbsp;</title>

    {% assets "css/bootstrap.min.css", "css/clean-blog.css", "video-js/video-js.min.css" %}
        <link href="{{ ASSET_URL }}" rel="stylesheet" />
    {% endassets %}
    <style>
        html {overflow-x:hidden;}
        body {font-family:arial;margin:0;padding:0;}

        video, object {
            top:0;left:0;
            position:absolute;
        }

/*        #maximage {
                      position:fixed !important;
            /*position:relative !important;
        }*/

.post-heading h1[data-name=name], .post-heading h2{
  color:#000;
}
        h1, h2 {
            background:white;
            background-color:rgba(255, 255, 255, 0.8);
            /* For IE 5.5 - 7*/
            filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99FFFFFF, endColorstr=#99FFFFFF);
            /* For IE 8*/
            -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99FFFFFF, endColorstr=#99FFFFFF)";
            position:relative;
            padding:0px;
            margin:0px;
        }
        .no-content-found p {
            color:#333;
        }
        .no-content-found h1{
            background:black;
            background-color:rgba(0, 0, 0, 0.8);
            position:relative;
            padding:10px;
        }
    </style>

    {% assets "js/modernizr-2.8.3-custom.min.js" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

</head>

<body>

    <!-- Main Content Page -->
    <div id="content" class="container-fluid"></div>

    <!-- Page Templates -->
    {% raw %}
    <script id="tpl-layout-no_content_template" type="text/x-handlebars-template">
        <header class="intro-header">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading no-content-found">
                    <h1 data-name="name">No Feed could be found<br/><small>Please ensure this box is connected to a project</small></h1>
                    <p><small>{{ settings.CORE_SERVER }}</small></p>
                </div>
            </div>
        </header>
    </script>

    <script id="tpl-layout-basic" type="text/x-handlebars-template">
        <header class="intro-header" style="background-image: url('{{ object.picture }}');">
            <div class="container">
                <div class="row">
                    &nbsp;
                </div>
            </div>

            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1 data-name="name">{{ object.name }}</h1>
                    <h2 class="subheading" data-name="message">{{ object.message }}</h2>
                </div>
            </div>
        </header>

        <article>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1" data-name="description">
                        {{ object.description }}
                    </div>
                </div>
            </div>
        </article>
    </script>

    <script id="tpl-layout-video" type="text/x-handlebars-template">
        <video id="video_fullscreen" class="video-js vjs-default-skin"
          controls preload="auto" width="640" height="264"
          poster="{{ object.picture }}"
          data-setup='{"example_option":false}'>
         <source src="{{ object.video }}" type='video/mp4' />
         <source src="{{ object.video }}" type='video/webm' />
         <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
        </video>
        <script type="text/javascript" charset="utf-8">
        $(function(){
            // Helper function to Fill and Center the HTML5 Video
            jQuery('video').maximage('maxcover');
        });
        </script>
    </script>

    <script id="tpl-layout-image" type="text/x-handlebars-template">
        <div id="maximage">
            <img src="{{ object.picture }}" />
        </div>
            <h1>{{ object.name }}</h1>
            <p>{{ object.description }}</p>
        <script type="text/javascript" charset="utf-8">
        $(function(){
            // Helper function to Fill and Center the HTML5 Video
            jQuery('#maximage').maximage('maxcover');
        });
        </script>
    </script>
    {% endraw %}

    <!-- jQuery -->
    {% assets "js/jquery.min.js", "js/jquery-ui.min.js", "js/chute.jquery.js", "js/maximage-2.0.js", "js/pusher-2.1.6.min.js", "js/handlebars.min.js", "js/js-signals.min.js", "js/hasher.min.js", "js/bootstrap.min.js", "js/clean-blog.js", "video-js/video.js" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    {% assets "video-js/video-js.swf" %}
    <script>
      videojs.options.flash.swf = "{{ ASSET_URL }}"
    </script>
    {% endassets %}

    <script>
    'use strict';
    $(document).ready(function( ) {
        var listen_to_pusher = function ( current_item, settings ) {
            if ( settings.project !== null ) {
                Pusher.host    = 'localhost'
                Pusher.ws_port = 8080
                Pusher.wss_port = 8080
                var pusher = new Pusher('{{ pusher.PUSHER_KEY }}', { authEndpoint: chute_object.settings.CORE_SERVER_ENDPOINT + 'box/auth/pusher/'});
                var pusher_channels = {
                    'project': pusher.subscribe('presence-' + chute_object.project.slug ),
                    'box': pusher.subscribe(chute_object.project.slug +'-{{ mac_addr }}'),
                }

                pusher_channels.project.bind('reload', function(data) {
                  window.location.reload();
                });
                pusher_channels.box.bind('reload', function(data) {
                  window.location.reload();
                });
                pusher_channels.box.bind('goto', function(data) {
                  handleChanges( data.pk );
                });
            }
        };

        var no_content_template = $("script#tpl-layout-no_content_template").html();
        var basic_template = $("script#tpl-layout-basic").html();
        var video_template = $("script#tpl-layout-video").html();
        var image_template = $("script#tpl-layout-image").html();
        var image_left = $("script#tpl-layout-image").html();

        var chute_object = {
            'feed': {{ feed_json|safe }},
            'project': {{ project_json|safe }},
            'settings': {{ settings|safe }},
            'listeners': [listen_to_pusher],
            'templates': {
                'no_content': no_content_template,
                'basic': basic_template,
                'video': video_template,
                'video_full': video_template,
                'image': image_template,
                'image_left': image_left
            },
        };

        $( "body" ).chute_controller(chute_object);
        window.chute = $( "body" ).data( 'chute-chute_controller' );

        //handle hash changes
        function handleChanges( newPk ){
            if ( newPk !== NaN && newPk !== '' ) {
                var pk = parseInt( newPk );
                window.chute.goto( pk );
            }
        }

        hasher.changed.add(handleChanges); //add hash change listener
        hasher.initialized.add(handleChanges); //add initialized listener (to grab initial value in case it is already set)
        hasher.init(); //initialize hasher (start listening for history changes)

    });
    </script>
</body>

</html>
